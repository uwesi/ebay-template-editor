<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>eBay Template Editor â€“ Debug-freundlich</title>
<style>
  /* Minimal Editor Styles (GitHub Pages only) */
  *{box-sizing:border-box}
  body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#f4f6f8;color:#111}
  .app{max-width:1100px;margin:14px auto;padding:12px}
  header{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-bottom:12px}
  h1{font-size:1rem;margin:0}
  .controls{display:flex;gap:8px;align-items:center}
  select,button,input,textarea{padding:8px;border-radius:8px;border:1px solid #dde6ef;background:#fff}
  button{cursor:pointer;background:#0b79ff;color:#fff;border:none}
  .grid{display:grid;gap:12px}
  @media(min-width:960px){.grid{grid-template-columns:420px 1fr}}
  .card{background:#fff;padding:12px;border-radius:10px;border:1px solid #e6eef6}
  label{display:block;font-size:0.9rem;margin-bottom:6px}
  input,textarea,select{width:100%;font-size:0.95rem}
  textarea{resize:vertical;min-height:90px}
  iframe{width:100%;height:640px;border:1px solid #e6eef6;border-radius:6px}
  .error-banner{background:#fff0f0;border:1px solid #ffb3b3;color:#8a1212;padding:12px;border-radius:8px;margin-bottom:12px;display:none}
  .hint{font-size:0.85rem;color:#556;margin-top:8px}
  .small{font-size:0.85rem;color:#556}
</style>
</head>
<body>
  <div class="app">
    <div id="error" class="error-banner" role="alert" aria-live="assertive"></div>

    <header>
      <h1>eBay Template Editor (Debug-Version)</h1>
      <div class="controls">
        <select id="theme" title="Design wÃ¤hlen">
          <option value="blue">ðŸ”µ Blau</option>
          <option value="light">âšª Hell</option>
          <option value="green">ðŸŸ¢ GrÃ¼n</option>
          <option value="dark">âš« Anthrazit</option>
          <option value="red">ðŸ”´ Bordeaux</option>
        </select>
        <button id="copyBtn">HTML kopieren</button>
      </div>
    </header>

    <div class="grid">
      <div class="card">
        <label>Titel
          <input id="title" value="Beispiel: Ikea Sofa 3-Sitzer" />
        </label>

        <label>Beschreibung
          <textarea id="description">Beispielbeschreibung: gut erhalten, Nichtraucherhaushalt. MaÃŸe: L x B x H.</textarea>
        </label>

        <label>Bulletpoints (jede Zeile ein Punkt)
          <textarea id="bullets">Stabil und bequem
Geringe Gebrauchsspuren
Nichtraucherhaushalt</textarea>
        </label>

        <label>Rechtshinweis
          <textarea id="legal">&lt;RECHTS-HINWEIS: Privatverk&auml;ufer â€“ keine Garantie, keine R&uuml;cknahme.&gt;</textarea>
        </label>

        <label class="small"><input id="entities" type="checkbox" checked /> Umlaute automatisch in HTML-Entities umwandeln</label>

        <p class="hint">Wenn beim Laden etwas schiefgeht, wird oben eine Fehlermeldung angezeigt. Ã–ffne die Entwickler-Konsole (F12) fÃ¼r Details.</p>
      </div>

      <div class="card">
        <iframe id="preview" title="Live-Vorschau" sandbox="allow-same-origin"></iframe>
      </div>
    </div>
  </div>

<script>
/* --- Defensive JS: fÃ¤ngt Fehler und zeigt sie sichtbar an --- */
(function(){
  const showError = (msg)=> {
    const el = document.getElementById('error');
    el.style.display = 'block';
    el.textContent = 'Fehler im Editor: ' + msg;
    console.error('Editor-Fehler:', msg);
  };

  window.onerror = function(message, source, lineno, colno, error){
    try { showError(String(message || error || 'Unbekannter Fehler')); } catch(e){}
  };

  window.addEventListener('unhandledrejection', function(evt){
    try { showError('Unhandled Promise Rejection: ' + (evt.reason && evt.reason.message ? evt.reason.message : String(evt.reason))); } catch(e){}
  });

  try {
    // Elemente
    const theme = document.getElementById('theme');
    const title = document.getElementById('title');
    const description = document.getElementById('description');
    const bullets = document.getElementById('bullets');
    const legal = document.getElementById('legal');
    const preview = document.getElementById('preview');
    const copyBtn = document.getElementById('copyBtn');
    const entitiesBox = document.getElementById('entities');

    if(!preview) throw new Error('Vorschau-iframe fehlt');

    // Hilfsfunktionen
    const toEntities = (s) => {
      if(!s) return '';
      return String(s)
        .replace(/&/g,'&amp;')
        .replace(/</g,'&lt;')
        .replace(/>/g,'&gt;')
        .replace(/"/g,'&quot;')
        .replace(/'/g,'&#39;')
        .replace(/Ã„/g,'&Auml;').replace(/Ã¤/g,'&auml;')
        .replace(/Ã–/g,'&Ouml;').replace(/Ã¶/g,'&ouml;')
        .replace(/Ãœ/g,'&Uuml;').replace(/Ã¼/g,'&uuml;')
        .replace(/ÃŸ/g,'&szlig;');
    };

    const THEMES = {
      blue:{bg:'#232f3e',accent:'#febd69'},
      light:{bg:'#f7f7f7',accent:'#0b79ff'},
      green:{bg:'#0f3d2e',accent:'#2ecc71'},
      dark:{bg:'#1f2933',accent:'#9ca3af'},
      red:{bg:'#4c1d24',accent:'#b91c1c'}
    };

    // Build HTML fÃ¼r iframe
    function buildHtml(){
      const th = THEMES[theme.value] || THEMES.blue;
      let t = title.value || '';
      let d = description.value || '';
      let l = legal.value || '';
      let bLines = (bullets.value || '').split('\\n').map(x => x.trim()).filter(Boolean);

      if(entitiesBox.checked){
        t = toEntities(t);
        d = toEntities(d);
        l = toEntities(l);
        bLines = bLines.map(toEntities);
      }

      const bulletsHtml = bLines.map(b => '<li><span class="check">âœ”</span><span class="btext">'+b+'</span></li>').join('');

      const html = '<!doctype html><html lang="de"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">' +
      '<style>' +
      'html,body{margin:0;padding:0;font-family:Arial,Helvetica,sans-serif;background:#f4f6f8;color:#111}' +
      '.wrap{max-width:850px;width:100%;margin:10px auto;background:#fff;border:1px solid #ddd;border-radius:8px;overflow:hidden;box-sizing:border-box}' +
      '.header{background:'+th.bg+';color:#fff;padding:18px;text-align:center}.header h1{margin:0;font-size:1.05rem}' +
      '.content{padding:16px;line-height:1.5;color:#222}.price{color:'+th.accent+';font-weight:700}' +
      'ul{list-style:none;padding:0;margin:10px 0}li{display:flex;align-items:flex-start;margin:6px 0;word-break:break-word}.check{color:'+th.accent+';margin-right:8px}' +
      '.notice{font-size:12px;color:#666;border-top:1px dashed #ddd;padding-top:12px;margin-top:12px}' +
      '@media(max-width:480px){.header h1{font-size:1rem}.content{padding:12px}}' +
      '</style></head><body>' +
      '<div class="wrap" role="article"><div class="header"><h1>'+ (t || '&nbsp;') +'</h1></div>' +
      '<div class="content"><p>' + (d || '&nbsp;') + '</p>' + (bulletsHtml ? '<ul>' + bulletsHtml + '</ul>' : '') +
      '<div class="notice">' + (l || '&nbsp;') + '</div></div></div></body></html>';

      return html;
    }

    // Update preview
    function update(){
      try {
        const html = buildHtml();
        preview.srcdoc = html;
        window.finalHtml = html;
      } catch(e){
        showError('Fehler beim Erstellen der Vorschau: ' + (e && e.message ? e.message : e));
      }
    }

    // Copy handler
    copyBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(window.finalHtml || '');
        copyBtn.textContent = 'Kopiert!';
        setTimeout(()=>copyBtn.textContent = 'HTML kopieren', 1200);
      } catch(e){
        showError('Kopieren fehlgeschlagen: ' + (e && e.message ? e.message : e));
      }
    });

    // Input listeners
    [theme, title, description, bullets, legal, entitiesBox].forEach(el => {
      el.addEventListener('input', update);
    });

    // initial render
    update();

  } catch(err){
    try { document.getElementById('error').textContent = 'Initialisierung fehlgeschlagen: ' + err.message; document.getElementById('error').style.display='block'; } catch(e){}
    console.error('Initialisierungsfehler:', err);
  }
})();
</script>
</body>
</html>
